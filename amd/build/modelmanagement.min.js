define("mod_certifygen/modelmanagement",["exports","jquery","core/str","core/ajax","core/templates","core/modal_factory","core/modal_events","core/notification","core_form/modalform"],(function(_exports,_jquery,_str,_ajax,_templates,_modal_factory,_modal_events,_notification,_modalform){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_notification=_interopRequireDefault(_notification),_modalform=_interopRequireDefault(_modalform);let SERVICES_DELETE_MODEL="mod_certifygen_deletemodel",SERVICES_GET_LIST_TABLE="mod_certifygen_getmodellisttable",ACTION_DELETE_MODEL='[data-action="delete-model"]',ACTION_EDIT_MODEL='[data-action="edit-model"]',ACTION_ASSIGN_CONTEXTS='[data-action="assign-context"]',REGION_LIST_TABLE='[data-region="model-list-table"]',TEMPLATES_LOADING="core/overlay_loading",TEMPLATES_MODELLISTTABLE="mod_certifygen/model_list_table";const AssignContext=e=>{e.preventDefault();const element=e.target;let mainElement=event.currentTarget,id=event.currentTarget.getAttribute("data-id"),modelid=event.currentTarget.getAttribute("data-modelid"),name=event.currentTarget.getAttribute("data-name");const modalCForm=new _modalform.default({formClass:"mod_certifygen\\forms\\associatecontextform",args:{id:id,modelid:modelid},modalConfig:{title:(0,_str.get_string)("assigncontextto","mod_certifygen",name)},returnFocus:element});modalCForm.addEventListener(modalCForm.events.FORM_SUBMITTED,(result=>{mainElement.setAttribute("data-id",result.detail)})),modalCForm.show()},EditModel=e=>{e.preventDefault();const element=e.target;let id=0;"edit-model"===event.currentTarget.getAttribute("data-action")&&(id=event.currentTarget.getAttribute("data-id"));const modalForm=new _modalform.default({formClass:"mod_certifygen\\forms\\modelform",args:{id:id},modalConfig:{title:(0,_str.get_string)("create_model","mod_certifygen")},returnFocus:element});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(()=>{reloadModelListTable()})),modalForm.show()},reloadModelListTable=()=>{_templates.default.render(TEMPLATES_LOADING,{visible:!0}).done((function(html){let identifier=(0,_jquery.default)(REGION_LIST_TABLE);identifier.append(html);let request={methodname:SERVICES_GET_LIST_TABLE,args:{}};_ajax.default.call([request])[0].done((function(data){_templates.default.render(TEMPLATES_MODELLISTTABLE,data).then(((html,js)=>{identifier.html(html),_templates.default.runTemplateJS(js)})).fail(_notification.default.exception)})).fail(_notification.default.exception)}))},DeleteModel=event=>{let name=event.currentTarget.getAttribute("data-name"),modelId=event.currentTarget.getAttribute("data-id");const stringkeys=[{key:"deletemodeltitle",component:"mod_certifygen"},{key:"deletemodelbody",component:"mod_certifygen",param:name},{key:"confirm",component:"mod_certifygen"},{key:"errortitle",component:"mod_certifygen"}];(0,_str.get_strings)(stringkeys).then((langStrings=>_modal_factory.default.create({title:langStrings[0],body:langStrings[1],type:_modal_factory.default.types.SAVE_CANCEL}).then((modal=>(modal.getRoot().on(_modal_events.default.hidden,(()=>{modal.destroy()})),modal.getRoot().on(_modal_events.default.save,(()=>{let request={methodname:SERVICES_DELETE_MODEL,args:{id:modelId}};_ajax.default.call([request])[0].done((function(response){if(1!=response.result)return _modal_factory.default.create({title:langStrings[0],body:response.message,type:_modal_factory.default.types.CANCEL}).then((modal=>{modal.show(),modal.getRoot().on(_modal_events.default.hidden,(()=>{modal.destroy()}))}));(0,_jquery.default)(event.currentTarget).parent().parent().remove()})).fail(_notification.default.exception)})),modal))))).done((function(modal){modal.show()})).fail(_notification.default.exception)};_exports.init=()=>{(0,_jquery.default)(ACTION_DELETE_MODEL).on("click",DeleteModel),(0,_jquery.default)(ACTION_EDIT_MODEL).on("click",EditModel),(0,_jquery.default)(ACTION_ASSIGN_CONTEXTS).on("click",AssignContext.bind(void 0))}}));

//# sourceMappingURL=modelmanagement.min.js.map