{"version":3,"file":"certificatemanager.min.js","sources":["../src/certificatemanager.js"],"sourcesContent":["/**\n * @module    mod_certifygen\n * @copyright  2024 Proyecto UNIMOODLE\n * @author     UNIMOODLE Group (Coordinator) <direccion.area.estrategia.digital@uva.es>\n * @author     3IPUNT <contacte@tresipunt.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\"use strict\";\n\nimport jQuery from 'jquery';\nimport {get_strings as getStrings} from 'core/str';\nimport Ajax from 'core/ajax';\nimport Templates from 'core/templates';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Notification from 'core/notification';\n\nlet REGION = {\n    ROOT: '',\n};\nlet TEMPLATES = {\n    LOADING: 'core/overlay_loading',\n    TEACHER_TABLE: 'mod_certifygen/teacher',\n    STUDENTS_TABLE: 'mod_certifygen/my_certificates_validator',\n};\nlet ACTION = {\n    EMIT_CERTIFICATE: '[data-action=\"emit-certificate\"]',\n    REVOKE_CERTIFICATE: '[data-action=\"revoke-certificate\"]',\n};\nlet SERVICES = {\n    EMIT_CERTIFICATE: 'mod_certifygen_emitcertificate',\n    MYSTUDENTS_TABLE_DATA: 'mod_certifygen_get_students_certificates_table',\n    GET_MYCERTIFICATE_TABLE_DATA: 'mod_certifygen_getmycertificatedata',\n    REVOKE_CERTIFICATE: 'mod_certifygen_revokecertificate',\n};\nconst certificateManagement = () => {\n    jQuery(ACTION.EMIT_CERTIFICATE).on('click', emitCertificate);\n    jQuery(ACTION.REVOKE_CERTIFICATE).on('click', revokeCertificate);\n};\nconst revokeCertificate = async(event) => {\n    let issueid = event.currentTarget.getAttribute('data-issueid');\n    let cmid = event.currentTarget.getAttribute('data-cmid');\n    let userid = event.currentTarget.getAttribute('data-userid');\n    let modelid = event.currentTarget.getAttribute('data-modelid');\n    let courseid = event.currentTarget.getAttribute('data-courseid');\n    let username = event.currentTarget.getAttribute('data-username');\n    // Modal estas seguro que quieres eliminar el certiifcado?.\n    const stringkeys = [\n        {key: 'revokecertificate_title', component: 'mod_certifygen'},\n        {key: 'revokecertificate_body', component: 'mod_certifygen', param: username},\n        {key: 'confirm', component: 'mod_certifygen'},\n        {key: 'revokecertificate_error', component: 'mod_certifygen'}\n    ];\n    let langStrings = await getStrings(stringkeys);\n\n    let modal = await ModalFactory.create({\n        title: langStrings[0],\n        body: langStrings[1],\n        type: ModalFactory.types.SAVE_CANCEL\n    });\n    modal.setSaveButtonText(langStrings[2]);\n    modal.getRoot().on(ModalEvents.save, () => {\n        let request = {\n            methodname: SERVICES.REVOKE_CERTIFICATE,\n            args: {\n                issueid,\n                userid,\n                modelid,\n            }\n        };\n        modal.destroy();\n        Ajax.call([request])[0].done(function(response) {\n            if (response.result === true) {\n                teacherReloadTable(modelid, courseid, cmid);\n            } else {\n                Notification.alert('Error', response.message, langStrings[2]);\n            }\n        }).fail(Notification.exception);\n    });\n    modal.getRoot().on(ModalEvents.hidden, () => {\n        modal.destroy();\n    });\n    modal.show();\n};\nconst emitCertificate = async(event) => {\n    let id = parseInt(event.currentTarget.getAttribute('data-id'));\n    let modelid = parseInt(event.currentTarget.getAttribute('data-modelid'));\n    let lang = event.currentTarget.getAttribute('data-lang');\n    let langstring = event.currentTarget.getAttribute('data-langstring');\n    let userid = parseInt(event.currentTarget.getAttribute('data-userid'));\n    let courseid = parseInt(event.currentTarget.getAttribute('data-courseid'));\n    let cmid = parseInt(event.currentTarget.getAttribute('data-cmid'));\n\n    // Modal estas seguro que quieres enviar el certiifcado?.\n    const stringkeys = [\n        {key: 'emitcertificate_title', component: 'mod_certifygen'},\n        {key: 'emitcertificate_body', component: 'mod_certifygen', param: langstring},\n        {key: 'confirm', component: 'mod_certifygen'},\n        {key: 'emitcertificate_error', component: 'mod_certifygen'}\n    ];\n    let langStrings = await getStrings(stringkeys);\n\n    let modal = await ModalFactory.create({\n        title: langStrings[0],\n        body: langStrings[1],\n        type: ModalFactory.types.SAVE_CANCEL\n    });\n    modal.setSaveButtonText(langStrings[2]);\n    modal.getRoot().on(ModalEvents.save, () => {\n        let request = {\n            methodname: SERVICES.EMIT_CERTIFICATE,\n            args: {\n                id,\n                modelid,\n                lang,\n                userid,\n                courseid,\n            }\n        };\n        modal.destroy();\n        Ajax.call([request])[0].done(function(response) {\n            if (response.result === true) {\n                studentsReloadTable(modelid, courseid, cmid);\n            } else {\n                Notification.alert('Error', response.message, langStrings[2]);\n            }\n        }).fail(Notification.exception);\n    });\n    modal.getRoot().on(ModalEvents.hidden, () => {\n        modal.destroy();\n    });\n    modal.show();\n};\nconst teacherReloadTable = (modelid, courseid, cmid) => {\n    modelid = parseInt(modelid);\n    courseid = parseInt(courseid);\n    cmid = parseInt(cmid);\n    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n        let identifier = jQuery(REGION.ROOT);\n        identifier.append(html);\n        let request = {\n            methodname: SERVICES.MYSTUDENTS_TABLE_DATA,\n            args: {modelid, courseid, cmid}\n        };\n        Ajax.call([request])[0].done(function(data) {\n            Templates.render(TEMPLATES.TEACHER_TABLE, data).then((html, js) => {\n                identifier.html(html);\n                Templates.runTemplateJS(js);\n            }).fail(Notification.exception);\n        }).fail((error) => {\n            Notification.alert('Error', error.message, 'cancel');\n        });\n    });\n};\nconst studentsReloadTable = (modelid, courseid, cmid) => {\n    modelid = parseInt(modelid);\n    courseid = parseInt(courseid);\n    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n        let identifier = jQuery(REGION.ROOT);\n        identifier.append(html);\n        let request = {\n            methodname: SERVICES.GET_MYCERTIFICATE_TABLE_DATA,\n            args: {modelid, courseid, cmid}\n        };\n        Ajax.call([request])[0].done(function(data) {\n            Templates.render(TEMPLATES.STUDENTS_TABLE, data).then((html, js) => {\n                identifier.html(html);\n                Templates.runTemplateJS(js);\n            }).fail(Notification.exception);\n        }).fail((error) => {\n            Notification.alert('Error', error.message, 'cancel');\n        });\n    });\n};\nexport const init = (root) => {\n    REGION.ROOT = root;\n    certificateManagement();\n};"],"names":["REGION","ROOT","TEMPLATES","ACTION","SERVICES","revokeCertificate","async","issueid","event","currentTarget","getAttribute","cmid","userid","modelid","courseid","stringkeys","key","component","param","langStrings","modal","ModalFactory","create","title","body","type","types","SAVE_CANCEL","setSaveButtonText","getRoot","on","ModalEvents","save","request","methodname","args","destroy","call","done","response","result","teacherReloadTable","alert","message","fail","Notification","exception","hidden","show","emitCertificate","id","parseInt","lang","langstring","studentsReloadTable","render","visible","html","identifier","append","data","then","js","runTemplateJS","error","root"],"mappings":"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"}