{"version":3,"file":"studentcertificatemanager.min.js","sources":["../src/studentcertificatemanager.js"],"sourcesContent":["/**\n * @module    mod_certifygen\n * @copyright  2024 Proyecto UNIMOODLE\n * @author     UNIMOODLE Group (Coordinator) <direccion.area.estrategia.digital@uva.es>\n * @author     3IPUNT <contacte@tresipunt.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\"use strict\";\n\nimport jQuery from 'jquery';\nimport {get_strings as getStrings} from 'core/str';\nimport Ajax from 'core/ajax';\n// import Templates from 'core/templates';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Notification from 'core/notification';\n\nlet REGION = {\n    ROOT: '',\n};\n// let TEMPLATES = {\n//     LOADING: 'core/overlay_loading',\n//     STUDENT_TABLE: 'mod_certifygen/student',\n// };\nlet ACTION = {\n    DOWNLOAD_CERTIFICATE: '[data-action=\"download-certificate\"]',\n};\nlet SERVICES = {\n    DOWNLOAD_CERTIFICATE: 'mod_certifygen_downloadcertificate',\n    GET_MYCERTIFICATE_TABLE_DATA: 'mod_certifygen_getmycertificatedata',\n};\nconst certificateManagement = () => {\n    jQuery(ACTION.DOWNLOAD_CERTIFICATE).on('click', downloadCertificate);\n};\nconst downloadCertificate = async(event) => {\n    let modelid = parseInt(event.currentTarget.getAttribute('data-modelid'));\n    let lang = event.currentTarget.getAttribute('data-lang');\n    let langstring = event.currentTarget.getAttribute('data-langstring');\n    let userid = parseInt(event.currentTarget.getAttribute('data-userid'));\n    let courseid = parseInt(event.currentTarget.getAttribute('data-courseid'));\n    // let cmid = parseInt(event.currentTarget.getAttribute('data-cmid'));\n\n    // Modal estas seguro que quieres enviar el certiifcado?.\n    const stringkeys = [\n        {key: 'downloadcertificate_title', component: 'mod_certifygen'},\n        {key: 'downloadcertificate_body', component: 'mod_certifygen', param: langstring},\n        {key: 'confirm', component: 'mod_certifygen'},\n        {key: 'downloadcertificate_error', component: 'mod_certifygen'}\n    ];\n    let langStrings = await getStrings(stringkeys);\n\n    let modal = await ModalFactory.create({\n        title: langStrings[0],\n        body: langStrings[1],\n        type: ModalFactory.types.SAVE_CANCEL\n    });\n    modal.setSaveButtonText(langStrings[2]);\n    modal.getRoot().on(ModalEvents.save, () => {\n        let request = {\n            methodname: SERVICES.DOWNLOAD_CERTIFICATE,\n            args: {\n                modelid,\n                lang,\n                userid,\n                courseid,\n            }\n        };\n        modal.destroy();\n        Ajax.call([request])[0].done(function(response) {\n            if (response.result === true) {\n                jQuery(event.currentTarget).parent().parent().find(\".code\").html(response.codetag);\n                window.open(response.url, \"_blank\");\n            } else {\n                Notification.alert('Error', response.message, langStrings[2]);\n            }\n        }).fail(Notification.exception);\n    });\n    modal.getRoot().on(ModalEvents.hidden, () => {\n        modal.destroy();\n    });\n    modal.show();\n};\nexport const init = (root) => {\n    REGION.ROOT = root;\n    certificateManagement();\n};"],"names":["REGION","ROOT","ACTION","SERVICES","downloadCertificate","async","modelid","parseInt","event","currentTarget","getAttribute","lang","langstring","userid","courseid","stringkeys","key","component","param","langStrings","modal","ModalFactory","create","title","body","type","types","SAVE_CANCEL","setSaveButtonText","getRoot","on","ModalEvents","save","request","methodname","args","destroy","call","done","response","result","parent","find","html","codetag","window","open","url","alert","message","fail","Notification","exception","hidden","show","root"],"mappings":"0nBAiBIA,OAAS,CACTC,KAAM,IAMNC,4BACsB,uCAEtBC,8BACsB,2CAMpBC,oBAAsBC,MAAAA,YACpBC,QAAUC,SAASC,MAAMC,cAAcC,aAAa,iBACpDC,KAAOH,MAAMC,cAAcC,aAAa,aACxCE,WAAaJ,MAAMC,cAAcC,aAAa,mBAC9CG,OAASN,SAASC,MAAMC,cAAcC,aAAa,gBACnDI,SAAWP,SAASC,MAAMC,cAAcC,aAAa,wBAInDK,WAAa,CACf,CAACC,IAAK,4BAA6BC,UAAW,kBAC9C,CAACD,IAAK,2BAA4BC,UAAW,iBAAkBC,MAAON,YACtE,CAACI,IAAK,UAAWC,UAAW,kBAC5B,CAACD,IAAK,4BAA6BC,UAAW,uBAE9CE,kBAAoB,oBAAWJ,YAE/BK,YAAcC,uBAAaC,OAAO,CAClCC,MAAOJ,YAAY,GACnBK,KAAML,YAAY,GAClBM,KAAMJ,uBAAaK,MAAMC,cAE7BP,MAAMQ,kBAAkBT,YAAY,IACpCC,MAAMS,UAAUC,GAAGC,sBAAYC,MAAM,SAC7BC,QAAU,CACVC,WAAY/B,8BACZgC,KAAM,CACF7B,QAAAA,QACAK,KAAAA,KACAE,OAAAA,OACAC,SAAAA,WAGRM,MAAMgB,wBACDC,KAAK,CAACJ,UAAU,GAAGK,MAAK,SAASC,WACV,IAApBA,SAASC,4BACFhC,MAAMC,eAAegC,SAASA,SAASC,KAAK,SAASC,KAAKJ,SAASK,SAC1EC,OAAOC,KAAKP,SAASQ,IAAK,iCAEbC,MAAM,QAAST,SAASU,QAAS9B,YAAY,OAE/D+B,KAAKC,sBAAaC,cAEzBhC,MAAMS,UAAUC,GAAGC,sBAAYsB,QAAQ,KACnCjC,MAAMgB,aAEVhB,MAAMkC,sBAEWC,OACjBvD,OAAOC,KAAOsD,yBAnDPrD,6BAA6B4B,GAAG,QAAS1B"}