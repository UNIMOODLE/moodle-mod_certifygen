{"version":3,"file":"modelcreate.min.js","sources":["../src/modelcreate.js"],"sourcesContent":["/**\n * @module    mod_certifygen\n * @copyright  2024 Proyecto UNIMOODLE\n * @author     UNIMOODLE Group (Coordinator) <direccion.area.estrategia.digital@uva.es>\n * @author     3IPUNT <contacte@tresipunt.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\"use strict\";\n\nimport jQuery from 'jquery';\nimport {get_string as getString} from 'core/str';\nimport Ajax from 'core/ajax';\nimport Templates from 'core/templates';\n// import ModalFactory from 'core/modal_factory';\n// import ModalEvents from 'core/modal_events';\nimport Notification from 'core/notification';\nimport ModalForm from 'core_form/modalform';\n\nlet SERVICES = {\n    GET_LIST_TABLE : 'mod_certifygen_getmodellisttable',\n};\nlet ACTION = {\n    CREATE_MODEL: '[data-action=\"create-model\"]',\n};\nlet REGION = {\n    ROOT: '[data-region=\"model-list-view\"]',\n    LIST_TABLE: '[data-region=\"model-list-table\"]',\n};\nlet TEMPLATES = {\n    LOADING: 'core/overlay_loading',\n    MODELLISTTABLE: 'mod_certifygen/model_list_table',\n};\nconst InitModelCreate = () => {\n    jQuery(ACTION.CREATE_MODEL).on('click', CreateModel);\n    jQuery('body').on('change', '.custom-select', function (event) {\n        if (event.target && event.target.name === 'type' && event.target.value == '2') {\n            addTemplateidValue();\n        } else if (event.target && event.target.name === 'type' && event.target.value == '1'\n        && jQuery('form [name=\"templateid\"]').length > 1) {\n            removeTemplateidVlaue();\n        } else {\n            checkTemplateidValue();\n        }\n    });\n    jQuery('body').on('focusout', 'input[type=\"text\"]', function () {\n        checkTemplateidValue();\n    });\n};\nconst checkTemplateidValue = () => {\n    let typeElement = document.querySelector('form [name=\"type\"]');\n    if (typeElement &&  typeElement.value == 2) {\n        addTemplateidValue();\n    }\n};\nconst removeTemplateidVlaue = () => {\n    jQuery('form [name=\"templateid\"]').each(function () {\n        if (this.type == 'hidden') {\n            jQuery(this).remove();\n        }\n    });\n};\nconst addTemplateidValue = () => {\n    const element = document.querySelector('form [name=\"templateid\"]');\n    if (element) {\n        element.setAttribute('data-initial-value', '0');\n    }\n    addHiddenTemplateidInput();\n};\nconst addHiddenTemplateidInput = () => {\n    jQuery(\"<input>\").attr({\n        name: \"templateid\",\n        type: \"hidden\",\n        value: 0\n    }).appendTo(\"form\");\n};\nconst CreateModel = (e) => {\n    e.preventDefault();\n    const element = e.target;\n    let id = 0;\n    if (event.currentTarget.getAttribute('data-action') === 'edit-model') {\n        id = event.currentTarget.getAttribute('data-id');\n    }\n    const modalForm = new ModalForm({\n        // Name of the class where form is defined (must extend \\core_form\\dynamic_form):\n        formClass: \"mod_certifygen\\\\forms\\\\modelform\",\n        // Add as many arguments as you need, they will be passed to the form:\n        args: {id},\n        // Pass any configuration settings to the modal dialogue, for example, the title:\n        modalConfig: {title: getString('create_model', 'mod_certifygen')},\n        // DOM element that should get the focus after the modal dialogue is closed:\n        returnFocus: element,\n    });\n\n    // Listen to events if you want to execute something on form submit. Event detail will contain everything the process()\n    // function returned:\n    modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, () => {\n        // Recargar la tabla.\n        reloadModelListTable();\n\n    });\n    // Show the form.\n    modalForm.show();\n};\nconst reloadModelListTable = () => {\n    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function (html) {\n        let identifier = jQuery(REGION.LIST_TABLE);\n        identifier.append(html);\n        let request = {\n            methodname: SERVICES.GET_LIST_TABLE,\n            args: {}\n        };\n        Ajax.call([request])[0].done(function (data) {\n            Templates.render(TEMPLATES.MODELLISTTABLE, data).then((html, js) => {\n                identifier.html(html);\n                Templates.runTemplateJS(js);\n            }).fail(Notification.exception);\n        }).fail(Notification.exception);\n    });\n};\n\nexport const init = () => {\n    InitModelCreate();\n};\n"],"names":["SERVICES","ACTION","REGION","TEMPLATES","checkTemplateidValue","typeElement","document","querySelector","value","addTemplateidValue","removeTemplateidVlaue","each","this","type","remove","element","setAttribute","addHiddenTemplateidInput","attr","name","appendTo","CreateModel","e","preventDefault","target","id","event","currentTarget","getAttribute","modalForm","ModalForm","formClass","args","modalConfig","title","returnFocus","addEventListener","events","FORM_SUBMITTED","reloadModelListTable","show","render","visible","done","html","identifier","append","request","methodname","call","data","then","js","runTemplateJS","fail","Notification","exception","on","length"],"mappings":"qlBAkBIA,wBACiB,mCAEjBC,oBACc,+BAEdC,kBAEY,mCAEZC,kBACS,uBADTA,yBAEgB,wCAkBdC,qBAAuB,SACrBC,YAAcC,SAASC,cAAc,sBACrCF,aAAqC,GAArBA,YAAYG,OAC5BC,sBAGFC,sBAAwB,yBACnB,4BAA4BC,MAAK,WACnB,UAAbC,KAAKC,0BACED,MAAME,aAInBL,mBAAqB,WACjBM,QAAUT,SAASC,cAAc,4BACnCQ,SACAA,QAAQC,aAAa,qBAAsB,KAE/CC,4BAEEA,yBAA2B,yBACtB,WAAWC,KAAK,CACnBC,KAAM,aACNN,KAAM,SACNL,MAAO,IACRY,SAAS,SAEVC,YAAeC,IACjBA,EAAEC,uBACIR,QAAUO,EAAEE,WACdC,GAAK,EAC+C,eAApDC,MAAMC,cAAcC,aAAa,iBACjCH,GAAKC,MAAMC,cAAcC,aAAa,kBAEpCC,UAAY,IAAIC,mBAAU,CAE5BC,UAAW,mCAEXC,KAAM,CAACP,GAAAA,IAEPQ,YAAa,CAACC,OAAO,mBAAU,eAAgB,mBAE/CC,YAAapB,UAKjBc,UAAUO,iBAAiBP,UAAUQ,OAAOC,gBAAgB,KAExDC,0BAIJV,UAAUW,QAERD,qBAAuB,wBACfE,OAAOtC,kBAAmB,CAACuC,SAAS,IAAOC,MAAK,SAAUC,UAC5DC,YAAa,mBAAO3C,mBACxB2C,WAAWC,OAAOF,UACdG,QAAU,CACVC,WAAYhD,wBACZgC,KAAM,kBAELiB,KAAK,CAACF,UAAU,GAAGJ,MAAK,SAAUO,yBACzBT,OAAOtC,yBAA0B+C,MAAMC,MAAK,CAACP,KAAMQ,MACzDP,WAAWD,KAAKA,yBACNS,cAAcD,OACzBE,KAAKC,sBAAaC,cACtBF,KAAKC,sBAAaC,6BAIT,yBAvFTvD,qBAAqBwD,GAAG,QAASpC,iCACjC,QAAQoC,GAAG,SAAU,kBAAkB,SAAU/B,OAChDA,MAAMF,QAAgC,SAAtBE,MAAMF,OAAOL,MAAyC,KAAtBO,MAAMF,OAAOhB,MAC7DC,qBACOiB,MAAMF,QAAgC,SAAtBE,MAAMF,OAAOL,MAAyC,KAAtBO,MAAMF,OAAOhB,QACrE,mBAAO,4BAA4BkD,OAAS,EAC3ChD,wBAEAN,8CAGD,QAAQqD,GAAG,WAAY,sBAAsB,WAChDrD"}