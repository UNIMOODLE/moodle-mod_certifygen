define("mod_certifygen/studentcertificatemanager",["exports","jquery","core/str","core/ajax","core/modal_factory","core/modal_events","core/notification"],(function(_exports,_jquery,_str,_ajax,_modal_factory,_modal_events,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_notification=_interopRequireDefault(_notification);let REGION={ROOT:""},ACTION_DOWNLOAD_CERTIFICATE='[data-action="download-certificate"]',SERVICES_DOWNLOAD_CERTIFICATE="mod_certifygen_downloadcertificate";const downloadCertificate=async event=>{let modelid=parseInt(event.currentTarget.getAttribute("data-modelid")),lang=event.currentTarget.getAttribute("data-lang"),langstring=event.currentTarget.getAttribute("data-langstring"),userid=parseInt(event.currentTarget.getAttribute("data-userid")),courseid=parseInt(event.currentTarget.getAttribute("data-courseid"));const stringkeys=[{key:"downloadcertificate_title",component:"mod_certifygen"},{key:"downloadcertificate_body",component:"mod_certifygen",param:langstring},{key:"confirm",component:"mod_certifygen"},{key:"downloadcertificate_error",component:"mod_certifygen"}];let langStrings=await(0,_str.get_strings)(stringkeys),modal=await _modal_factory.default.create({title:langStrings[0],body:langStrings[1],type:_modal_factory.default.types.SAVE_CANCEL});modal.setSaveButtonText(langStrings[2]),modal.getRoot().on(_modal_events.default.save,(()=>{let request={methodname:SERVICES_DOWNLOAD_CERTIFICATE,args:{modelid:modelid,lang:lang,userid:userid,courseid:courseid}};modal.destroy(),_ajax.default.call([request])[0].done((function(response){!0===response.result?((0,_jquery.default)(event.currentTarget).parent().parent().find(".code").html(response.codetag),window.open(response.url,"_blank")):_notification.default.alert("Error",response.message,langStrings[2])})).fail(_notification.default.exception)})),modal.getRoot().on(_modal_events.default.hidden,(()=>{modal.destroy()})),modal.show()};_exports.init=root=>{REGION.ROOT=root,(0,_jquery.default)(ACTION_DOWNLOAD_CERTIFICATE).on("click",downloadCertificate)}}));

//# sourceMappingURL=studentcertificatemanager.min.js.map