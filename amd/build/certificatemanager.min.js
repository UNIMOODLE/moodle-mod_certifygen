define("mod_certifygen/certificatemanager",["exports","jquery","core/str","core/ajax","core/templates","core/modal_factory","core/modal_events","core/notification"],(function(_exports,_jquery,_str,_ajax,_templates,_modal_factory,_modal_events,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_notification=_interopRequireDefault(_notification);let REGION_ROOT='[data-region="certificate-validator"]',TEMPLATES_LOADING="core/overlay_loading",TEMPLATES_TABLE="mod_certifygen/my_certificates_validator",ACTION_EMIT_CERTIFICATE='[data-action="emit-certificate"]',SERVICES_EMIT_CERTIFICATE="mod_certifygen_emitcertificate",SERVICES_GET_TABLE_DATA="mod_certifygen_getcontextcertificatedata";const EmitCertificate=async event=>{let id=event.currentTarget.getAttribute("data-id"),modelid=event.currentTarget.getAttribute("data-modelid"),lang=event.currentTarget.getAttribute("data-lang"),langstring=event.currentTarget.getAttribute("data-langstring"),userid=event.currentTarget.getAttribute("data-userid"),courseid=event.currentTarget.getAttribute("data-courseid");const stringkeys=[{key:"emitcertificate_title",component:"mod_certifygen"},{key:"emitcertificate_body",component:"mod_certifygen",param:langstring},{key:"confirm",component:"mod_certifygen"},{key:"emitcertificate_error",component:"mod_certifygen"}];let langStrings=await(0,_str.get_strings)(stringkeys),modal=await _modal_factory.default.create({title:langStrings[0],body:langStrings[1],type:_modal_factory.default.types.SAVE_CANCEL});modal.setSaveButtonText(langStrings[2]),modal.getRoot().on(_modal_events.default.save,(()=>{let request={methodname:SERVICES_EMIT_CERTIFICATE,args:{id:id,modelid:modelid,lang:lang,userid:userid,courseid:courseid}};modal.destroy(),_ajax.default.call([request])[0].done((function(response){!0===response.result?reloadTable(modelid,courseid):_notification.default.alert("Error",response.message,langStrings[2])})).fail(_notification.default.exception)})),modal.getRoot().on(_modal_events.default.hidden,(()=>{modal.destroy()})),modal.show()},reloadTable=(modelid,courseid)=>{modelid=parseInt(modelid),courseid=parseInt(courseid),_templates.default.render(TEMPLATES_LOADING,{visible:!0}).done((function(html){let identifier=(0,_jquery.default)(REGION_ROOT);identifier.append(html);let request={methodname:SERVICES_GET_TABLE_DATA,args:{modelid:modelid,courseid:courseid}};_ajax.default.call([request])[0].done((function(data){_templates.default.render(TEMPLATES_TABLE,data).then(((html,js)=>{identifier.html(html),_templates.default.runTemplateJS(js)})).fail(_notification.default.exception)})).fail((error=>{_notification.default.alert(error)}))}))};_exports.init=()=>{(0,_jquery.default)(ACTION_EMIT_CERTIFICATE).on("click",EmitCertificate)}}));

//# sourceMappingURL=certificatemanager.min.js.map