define("mod_certifygen/certificatemanager",["exports","jquery","core/str","core/ajax","core/templates","core/modal_factory","core/modal_events","core/notification"],(function(_exports,_jquery,_str,_ajax,_templates,_modal_factory,_modal_events,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_notification=_interopRequireDefault(_notification);let REGION={ROOT:""},TEMPLATES_LOADING="core/overlay_loading",TEMPLATES_TEACHER_TABLE="mod_certifygen/teacher",TEMPLATES_STUDENTS_TABLE="mod_certifygen/my_certificates_validator",ACTION_EMIT_CERTIFICATE='[data-action="emit-certificate"]',ACTION_REVOKE_CERTIFICATE='[data-action="revoke-certificate"]',SERVICES_EMIT_CERTIFICATE="mod_certifygen_emitcertificate",SERVICES_MYSTUDENTS_TABLE_DATA="mod_certifygen_get_students_certificates_table",SERVICES_GET_MYCERTIFICATE_TABLE_DATA="mod_certifygen_getmycertificatedata",SERVICES_REVOKE_CERTIFICATE="mod_certifygen_revokecertificate";const revokeCertificate=async event=>{let issueid=event.currentTarget.getAttribute("data-issueid"),cmid=event.currentTarget.getAttribute("data-cmid"),userid=event.currentTarget.getAttribute("data-userid"),modelid=event.currentTarget.getAttribute("data-modelid"),courseid=event.currentTarget.getAttribute("data-courseid");const stringkeys=[{key:"revokecertificate_title",component:"mod_certifygen"},{key:"revokecertificate_body",component:"mod_certifygen",param:event.currentTarget.getAttribute("data-username")},{key:"confirm",component:"mod_certifygen"},{key:"revokecertificate_error",component:"mod_certifygen"}];let langStrings=await(0,_str.get_strings)(stringkeys),modal=await _modal_factory.default.create({title:langStrings[0],body:langStrings[1],type:_modal_factory.default.types.SAVE_CANCEL});modal.setSaveButtonText(langStrings[2]),modal.getRoot().on(_modal_events.default.save,(()=>{let request={methodname:SERVICES_REVOKE_CERTIFICATE,args:{issueid:issueid,userid:userid,modelid:modelid}};modal.destroy(),_ajax.default.call([request])[0].done((function(response){!0===response.result?teacherReloadTable(modelid,courseid,cmid):_notification.default.alert("Error",response.message,langStrings[2])})).fail(_notification.default.exception)})),modal.getRoot().on(_modal_events.default.hidden,(()=>{modal.destroy()})),modal.show()},emitCertificate=async event=>{let id=parseInt(event.currentTarget.getAttribute("data-id")),modelid=parseInt(event.currentTarget.getAttribute("data-modelid")),lang=event.currentTarget.getAttribute("data-lang"),langstring=event.currentTarget.getAttribute("data-langstring"),userid=parseInt(event.currentTarget.getAttribute("data-userid")),courseid=parseInt(event.currentTarget.getAttribute("data-courseid")),cmid=parseInt(event.currentTarget.getAttribute("data-cmid"));const stringkeys=[{key:"emitcertificate_title",component:"mod_certifygen"},{key:"emitcertificate_body",component:"mod_certifygen",param:langstring},{key:"confirm",component:"mod_certifygen"},{key:"emitcertificate_error",component:"mod_certifygen"}];let langStrings=await(0,_str.get_strings)(stringkeys),modal=await _modal_factory.default.create({title:langStrings[0],body:langStrings[1],type:_modal_factory.default.types.SAVE_CANCEL});modal.setSaveButtonText(langStrings[2]),modal.getRoot().on(_modal_events.default.save,(()=>{let request={methodname:SERVICES_EMIT_CERTIFICATE,args:{id:id,modelid:modelid,lang:lang,userid:userid,courseid:courseid}};modal.destroy(),_ajax.default.call([request])[0].done((function(response){!0===response.result?studentsReloadTable(modelid,courseid,cmid,lang):_notification.default.alert("Error",response.message,langStrings[2])})).fail(_notification.default.exception)})),modal.getRoot().on(_modal_events.default.hidden,(()=>{modal.destroy()})),modal.show()},teacherReloadTable=(modelid,courseid,cmid)=>{modelid=parseInt(modelid),courseid=parseInt(courseid),cmid=parseInt(cmid),_templates.default.render(TEMPLATES_LOADING,{visible:!0}).done((function(html){let identifier=(0,_jquery.default)(REGION.ROOT);identifier.append(html);let request={methodname:SERVICES_MYSTUDENTS_TABLE_DATA,args:{modelid:modelid,courseid:courseid,cmid:cmid}};_ajax.default.call([request])[0].done((function(data){_templates.default.render(TEMPLATES_TEACHER_TABLE,data).then(((html,js)=>{identifier.html(html),_templates.default.runTemplateJS(js)})).fail(_notification.default.exception)})).fail((error=>{_notification.default.alert("Error",error.message,"cancel")}))}))},studentsReloadTable=(modelid,courseid,cmid,lang)=>{modelid=parseInt(modelid),courseid=parseInt(courseid),cmid=parseInt(cmid),_templates.default.render(TEMPLATES_LOADING,{visible:!0}).done((function(html){let identifier=(0,_jquery.default)(REGION.ROOT);identifier.append(html);let request={methodname:SERVICES_GET_MYCERTIFICATE_TABLE_DATA,args:{modelid:modelid,courseid:courseid,cmid:cmid,lang:lang}};_ajax.default.call([request])[0].done((function(data){_templates.default.render(TEMPLATES_STUDENTS_TABLE,data).then((function(html,js){identifier.html(html),_templates.default.runTemplateJS(js)})).fail(_notification.default.exception)})).fail((error=>{_notification.default.alert("Error",error.message,"cancel")}))}))};_exports.init=root=>{REGION.ROOT=root,(0,_jquery.default)(ACTION_EMIT_CERTIFICATE).on("click",emitCertificate),(0,_jquery.default)(ACTION_REVOKE_CERTIFICATE).on("click",revokeCertificate)}}));

//# sourceMappingURL=certificatemanager.min.js.map