define("mod_certifygen/requestmanagement",["exports","jquery","core/str","core/ajax","core/templates","core/modal_factory","core/modal_events","core/notification","core_form/modalform"],(function(_exports,_jquery,_str,_ajax,_templates,_modal_factory,_modal_events,_notification,_modalform){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_notification=_interopRequireDefault(_notification),_modalform=_interopRequireDefault(_modalform);let REGION_ROOT='[data-region="profile-my-certificates"]',TEMPLATES_LOADING="core/overlay_loading",TEMPLATES_TEACHER_REQUEST="mod_certifygen/profile_my_certificates",TEMPLATES_COURSE_LIST_REQUEST="mod_certifygen/course_list_request",ACTION_CREATE_REQUEST='[data-action="create-request"]',ACTION_DELETE_REQUEST='[data-action="delete-request"]',ACTION_SEE_COURSES='[data-action="see-courses"]',ACTION_EMIT='[data-action="emit"]',ACTION_DOWNLOAD='[data-action="download-certificate"]',SERVICES_GET_TEACHER_REQUEST_VIEW_DATA="mod_certifygen_getteacherrequestviewdata",SERVICES_DELETE_TEACHER_REQUEST="mod_certifygen_deleteteacherrequest",SERVICES_GET_COURSES_NAMES="mod_certifygen_getcoursesnames",SERVICES_EMIT_TEACHER_REQUEST="mod_certifygen_emitteacherrequest",SERVICES_DOWNLOAD_TEACHER_CERTIFICATE="mod_certifygen_downloadteachercertificate";const downloadCertificate=async event=>{let id=parseInt(event.currentTarget.getAttribute("data-id"));const stringkeys=[{key:"downloadcertificate_title",component:"mod_certifygen"},{key:"downloadcertificate_body",component:"mod_certifygen",param:event.currentTarget.getAttribute("data-name")},{key:"confirm",component:"mod_certifygen"},{key:"downloadcertificate_error",component:"mod_certifygen"}];let langStrings=await(0,_str.get_strings)(stringkeys),modal=await _modal_factory.default.create({title:langStrings[0],body:langStrings[1],type:_modal_factory.default.types.SAVE_CANCEL});modal.setSaveButtonText(langStrings[2]),modal.getRoot().on(_modal_events.default.save,(()=>{let request={methodname:SERVICES_DOWNLOAD_TEACHER_CERTIFICATE,args:{id:id}};modal.destroy(),_ajax.default.call([request])[0].done((function(response){!0===response.result?window.open(response.url,"_blank"):_notification.default.alert("Error",response.message,langStrings[2])})).fail(_notification.default.exception)})),modal.getRoot().on(_modal_events.default.hidden,(()=>{modal.destroy()})),modal.show()},emitCertificate=async event=>{let id=event.currentTarget.getAttribute("data-id");id=parseInt(id);let userid=event.currentTarget.getAttribute("data-userid");const stringkeys=[{key:"emitrequesttitle",component:"mod_certifygen"},{key:"emitrequestbody",component:"mod_certifygen",param:id},{key:"confirm",component:"mod_certifygen"},{key:"errortitle",component:"mod_certifygen"}];_templates.default.render(TEMPLATES_LOADING,{visible:!0}).done((function(html){let identifier=(0,_jquery.default)(REGION_ROOT);identifier.append(html),(0,_str.get_strings)(stringkeys).then((langStrings=>_modal_factory.default.create({title:langStrings[0],body:langStrings[1],type:_modal_factory.default.types.SAVE_CANCEL}).then((modal=>(modal.getRoot().on(_modal_events.default.hidden,(()=>{modal.destroy()})),modal.getRoot().on(_modal_events.default.cancel,(()=>{identifier.find(".overlay-icon-container").remove()})),modal.getRoot().on(_modal_events.default.save,(()=>{let request={methodname:SERVICES_EMIT_TEACHER_REQUEST,args:{id:id}};_ajax.default.call([request])[0].done((function(response){if(identifier.html(html),1!=response.result)return _modal_factory.default.create({title:langStrings[3],body:response.message,type:_modal_factory.default.types.CANCEL}).then((modal=>{modal.getRoot().on(_modal_events.default.hidden,(()=>{identifier.find(".overlay-icon-container").remove(),modal.destroy()})),modal.show()}));reloadTeacherRequestTable(userid)})).fail(_notification.default.exception)})),modal))))).done((function(modal){modal.show()})).fail(_notification.default.exception)}))},seeCourses=async event=>{let name=event.currentTarget.getAttribute("data-name"),coursesids=event.currentTarget.getAttribute("data-courses");const stringkeys=[{key:"seecoursestitle",component:"mod_certifygen",param:name}];let langStrings=await(0,_str.get_strings)(stringkeys),request={methodname:SERVICES_GET_COURSES_NAMES,args:{coursesids:coursesids}},coursesdata=await _ajax.default.call([request])[0],courseshtml=await _templates.default.render(TEMPLATES_COURSE_LIST_REQUEST,coursesdata).done((function(html){return html}));await _modal_factory.default.create({title:langStrings[0],body:courseshtml,type:_modal_factory.default.types.DEFAULT}).then((modal=>{modal.show(),modal.getRoot().on(_modal_events.default.hidden,(()=>{modal.destroy()}))}))},deleteRequest=event=>{let id=event.currentTarget.getAttribute("data-id");const stringkeys=[{key:"deleterequesttitle",component:"mod_certifygen"},{key:"deleterequestbody",component:"mod_certifygen",param:id},{key:"confirm",component:"mod_certifygen"},{key:"errortitle",component:"mod_certifygen"}];(0,_str.get_strings)(stringkeys).then((langStrings=>_modal_factory.default.create({title:langStrings[0],body:langStrings[1],type:_modal_factory.default.types.SAVE_CANCEL}).then((modal=>(modal.getRoot().on(_modal_events.default.hidden,(()=>{modal.destroy()})),modal.getRoot().on(_modal_events.default.save,(()=>{let request={methodname:SERVICES_DELETE_TEACHER_REQUEST,args:{id:id}};_ajax.default.call([request])[0].done((function(response){if(1!=response.result)return _modal_factory.default.create({title:langStrings[0],body:response.message,type:_modal_factory.default.types.CANCEL}).then((modal=>{modal.getRoot().on(_modal_events.default.hidden,(()=>{modal.destroy()}))}));(0,_jquery.default)(event.currentTarget).parent().parent().remove()})).fail(_notification.default.exception)})),modal))))).done((function(modal){modal.show()})).fail(_notification.default.exception)},createRequest=e=>{e.preventDefault();const element=e.target;let id=event.currentTarget.getAttribute("data-id"),userid=event.currentTarget.getAttribute("data-userid");const modalForm=new _modalform.default({formClass:"mod_certifygen\\forms\\teacherrequestform",args:{id:id,userid:userid},modalConfig:{title:(0,_str.get_string)("create_request","mod_certifygen")},returnFocus:element});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(()=>{setTimeout(reloadTeacherRequestTable(userid),1e3)})),modalForm.show()},reloadTeacherRequestTable=userid=>{_templates.default.render(TEMPLATES_LOADING,{visible:!0}).done((function(html){let identifier=(0,_jquery.default)(REGION_ROOT);identifier.append(html);let request={methodname:SERVICES_GET_TEACHER_REQUEST_VIEW_DATA,args:{userid:userid}};_ajax.default.call([request])[0].done((function(data){_templates.default.render(TEMPLATES_TEACHER_REQUEST,data).then(((html,js)=>{identifier.replaceWith(html),_templates.default.runTemplateJS(js)})).fail(_notification.default.exception)})).fail(_notification.default.exception)}))};_exports.init=()=>{(0,_jquery.default)(ACTION_CREATE_REQUEST).on("click",createRequest),(0,_jquery.default)(ACTION_DELETE_REQUEST).on("click",deleteRequest),(0,_jquery.default)(ACTION_SEE_COURSES).on("click",seeCourses),(0,_jquery.default)(ACTION_EMIT).on("click",emitCertificate),(0,_jquery.default)(ACTION_DOWNLOAD).on("click",downloadCertificate)}}));

//# sourceMappingURL=requestmanagement.min.js.map